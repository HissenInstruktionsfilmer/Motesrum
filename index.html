<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Mötesrum Status – Västberga</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; background: #f5f5f5; }
.status { font-size: 4em; font-weight: bold; margin-top: 50px; }
.ledigt { color: green; }
.upptaget { color: red; }
.meeting-list { margin-top: 20px; font-size: 1.2em; list-style: none; padding: 0; }
.meeting-list li { margin: 10px 0; }
</style>
</head>
<body>

<h1>Mötesrum – Västberga</h1>
<div id="status" class="status">Laddar...</div>
<ul id="meetingList" class="meeting-list"></ul>

<script>
async function updateStatus() {
    const statusEl = document.getElementById("status");
    const meetingListEl = document.getElementById("meetingList");

    try {
        const res = await fetch('https://nodejs-serverless-function-express-beta-dusky.vercel.app/api/roomStatus');
        const data = await res.json();

        const now = new Date();
        const meetings = data.meetings || [];

        // Kontrollera om pågående möte finns
        const ongoing = meetings.find(m => new Date(m.start.dateTime) <= now && now <= new Date(m.end.dateTime));
        statusEl.textContent = ongoing ? "Upptaget" : "Ledigt";
        statusEl.className = "status " + (ongoing ? "upptaget" : "ledigt");

        // Rensa listan
        meetingListEl.innerHTML = "";

        meetings.forEach(m => {
            const startTime = new Date(m.start.dateTime);
            const endTime = new Date(m.end.dateTime);
            const options = { hour: '2-digit', minute: '2-digit', timeZone: 'Europe/Stockholm' };

            const li = document.createElement("li");
            li.textContent = `${startTime.toLocaleTimeString('sv-SE', options)} - ${endTime.toLocaleTimeString('sv-SE', options)}: ${m.subject}`;
            
            // Lägg till deltagare om finns
            if (m.attendees.length > 0) {
                li.textContent += ` (Deltagare: ${m.attendees.map(a => a.emailAddress.name).join(", ")})`;
            }

            meetingListEl.appendChild(li);
        });

    } catch (err) {
        console.error("Fel vid hämtning av möten:", err);
        statusEl.textContent = "Fel vid laddning";
        meetingListEl.innerHTML = "";
    }
}

updateStatus();
setInterval(updateStatus, 60000);
</script>

</body>
</html>
