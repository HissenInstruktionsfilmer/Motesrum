<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Mötesrum Status – Västberga</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; background: #f5f5f5; }
.status { font-size: 4em; font-weight: bold; margin-top: 50px; }
.ledigt { color: green; }
.upptaget { color: red; }
.meeting-info { margin-top: 20px; font-size: 1.2em; }
.meeting-info p { margin: 5px 0; }
a { color: blue; text-decoration: none; }
a:hover { text-decoration: underline; }
</style>
</head>
<body>

<h1>Mötesrum – Västberga</h1>
<div id="status" class="status">Laddar...</div>
<div class="meeting-info">
  <p id="nextMeeting"></p>
  <p id="timeRange"></p>
  <p id="attendees"></p>
  <p id="location"></p>
  <p id="description"></p>
  <p id="teamsLink"></p>
</div>

<script>
async function updateStatus() {
    const statusEl = document.getElementById("status");
    const nextEl = document.getElementById("nextMeeting");
    const timeEl = document.getElementById("timeRange");
    const attendeesEl = document.getElementById("attendees");
    const locationEl = document.getElementById("location");
    const descEl = document.getElementById("description");
    const teamsEl = document.getElementById("teamsLink");

    try {
        const res = await fetch('https://nodejs-serverless-function-express-beta-dusky.vercel.app/api/roomStatus');
        const data = await res.json();
        const meeting = data.nextMeeting;
        const now = new Date();

        if (meeting && new Date(meeting.start.dateTime) <= now && now <= new Date(meeting.end.dateTime)) {
            statusEl.textContent = "Upptaget";
            statusEl.className = "status upptaget";
        } else {
            statusEl.textContent = "Ledigt";
            statusEl.className = "status ledigt";
        }

        if (meeting) {
            nextEl.textContent = "Nästa möte: " + meeting.subject;
            timeEl.textContent = new Date(meeting.start.dateTime).toLocaleTimeString() + " - " +
                                 new Date(meeting.end.dateTime).toLocaleTimeString();
            attendeesEl.textContent = "Deltagare: " +
                (meeting.attendees ? meeting.attendees.map(a => a.emailAddress.name).join(", ") : "-");
            locationEl.textContent = "Plats: " + (meeting.location.displayName || "-");
            descEl.textContent = "Beskrivning: " + (meeting.bodyPreview || "-");
            teamsEl.innerHTML = meeting.onlineMeeting?.joinUrl 
                ? `<a href="${meeting.onlineMeeting.joinUrl}" target="_blank">Gå med i Teams</a>` 
                : "";
        } else {
            nextEl.textContent = "";
            timeEl.textContent = "";
            attendeesEl.textContent = "";
            locationEl.textContent = "";
            descEl.textContent = "";
            teamsEl.innerHTML = "";
        }
    } catch (err) {
        console.error("Fel vid hämtning av möte:", err);
        statusEl.textContent = "Fel vid laddning";
        nextEl.textContent = "";
        timeEl.textContent = "";
        attendeesEl.textContent = "";
        locationEl.textContent = "";
        descEl.textContent = "";
        teamsEl.innerHTML = "";
    }
}

// Kör vid laddning och uppdatera varje minut
updateStatus();
setInterval(updateStatus, 60000);
</script>

</body>
</html>
