<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Mötesrum Status – Västberga</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; background: #f5f5f5; }
.status { font-size: 4em; font-weight: bold; margin-top: 50px; }
.ledigt { color: green; }
.upptaget { color: red; }
.meeting-info { margin-top: 20px; font-size: 1.2em; }
.meeting-info p { margin: 5px 0; }
</style>
</head>
<body>

<h1>Mötesrum – Västberga</h1>
<div id="status" class="status">Laddar...</div>
<div class="meeting-info">
  <p id="nextMeeting"></p>
  <p id="timeRange"></p>
  <p id="attendees"></p>
</div>

<script>
async function updateStatus() {
    const statusEl = document.getElementById("status");
    const nextEl = document.getElementById("nextMeeting");
    const timeEl = document.getElementById("timeRange");
    const attendeesEl = document.getElementById("attendees");

    try {
        const res = await fetch('https://nodejs-serverless-function-express-beta-dusky.vercel.app/api/roomStatus');
        const data = await res.json();

        const current = data.currentMeeting;
        const nextM = data.nextMeeting;
        let meetingToShow = current || nextM; // Visa pågående möte om det finns

        if (current) {
            statusEl.textContent = "Upptaget";
            statusEl.className = "status upptaget";
        } else {
            statusEl.textContent = "Ledigt";
            statusEl.className = "status ledigt";
        }

        if (meetingToShow) {
            const startTime = new Date(meetingToShow.start.dateTime);
            const endTime = new Date(meetingToShow.end.dateTime);
            const options = { hour: '2-digit', minute: '2-digit' };
            timeEl.textContent = startTime.toLocaleTimeString('sv-SE', options) + " - " +
                                 endTime.toLocaleTimeString('sv-SE', options);

            nextEl.textContent = (current ? "Pågående möte: " : "Nästa möte: ") + meetingToShow.subject;

            const attendees = (meetingToShow.attendees || [])
                .filter(a => a.emailAddress.name !== 'Mötesrum Test')
                .map(a => a.emailAddress.name)
                .join(", ") || "-";
            attendeesEl.textContent = "Deltagare: " + attendees;

        } else {
            nextEl.textContent = "";
            timeEl.textContent = "";
            attendeesEl.textContent = "";
        }

    } catch (err) {
        console.error("Fel vid hämtning av möte:", err);
        statusEl.textContent = "Fel vid laddning";
        nextEl.textContent = "";
        timeEl.textContent = "";
        attendeesEl.textContent = "";
    }
}

updateStatus();
setInterval(updateStatus, 60000);
</script>

</body>
</html>
