<script>
async function updateStatus() {
  const statusEl = document.getElementById("status");
  const nextEl = document.getElementById("nextMeeting");
  const timeEl = document.getElementById("timeRange");
  const attendeesEl = document.getElementById("attendees");
  const locationEl = document.getElementById("location");
  const descEl = document.getElementById("description");

  try {
    const res = await fetch('https://nodejs-serverless-function-express-beta-dusky.vercel.app/api/roomStatus');
    const data = await res.json();

    const meeting = data.nextMeeting;
    const now = new Date();

    if (meeting && new Date(meeting.start.dateTime) <= now && now <= new Date(meeting.end.dateTime)) {
      statusEl.textContent = "Upptaget";
      statusEl.className = "status upptaget";
    } else {
      statusEl.textContent = "Ledigt";
      statusEl.className = "status ledigt";
    }

    if (meeting) {
      nextEl.textContent = "Nästa möte: " + meeting.subject;
      timeEl.textContent = new Date(meeting.start.dateTime).toLocaleTimeString() + " - " +
                           new Date(meeting.end.dateTime).toLocaleTimeString();
      attendeesEl.textContent = "Deltagare: " +
          (meeting.attendees ? meeting.attendees.map(a => a.emailAddress.name).join(", ") : "-");
      locationEl.textContent = "Plats: " + (meeting.location.displayName || "-");
      descEl.textContent = "Beskrivning: " + (meeting.bodyPreview || "-");
    } else {
      nextEl.textContent = "";
      timeEl.textContent = "";
      attendeesEl.textContent = "";
      locationEl.textContent = "";
      descEl.textContent = "";
    }
  } catch (err) {
    console.error("Fel vid hämtning av möte:", err);
    statusEl.textContent = "Fel vid laddning";
    nextEl.textContent = "";
    timeEl.textContent = "";
    attendeesEl.textContent = "";
    locationEl.textContent = "";
    descEl.textContent = "";
  }
}

updateStatus();
setInterval(updateStatus, 60000);
</script>
