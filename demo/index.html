<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Mötesrum Översikt</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#bebfc2">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icons/conference-192.png">
<link rel="shortcut icon" href="icons/conference-192.png">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    touch-action: none;
    user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    background: #f0f2f5;
    font-family: "Segoe UI", Arial, sans-serif;
    color: #333;
}
header {
    background: #bebfc2;
    text-align: center;
    padding: 15px 0;
    font-size: 1.8em;
    font-weight: 600;
    color: #222;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    -webkit-touch-callout: none;
}
#roomsContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    padding: 20px;
}
.room-card {
    flex: 1 1 200px;
    min-width: 200px;
    max-width: 300px;
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    text-align: center;
    font-weight: 600;
    font-size: 1.1em;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    user-select: none;
}
.room-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
}
.room-card.ledigt { background-color: #d4edda; color: #155724; }
.room-card.upptaget { background-color: #f8d7da; color: #721c24; }
.error { text-align: center; color: #dc3545; font-size: 1.5em; margin-top: 40px; }
</style>
</head>
<body>

<header>Mötesrum Översikt</header>
<div id="roomsContainer">Laddar rum...</div>

<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(() => console.log('Service Worker registrerad'));
}

const API_URL = 'https://nodejs-serverless-function-express-beta-dusky.vercel.app/api/roomStatus';

// Lista över rum som ska visas
const rooms = [
    { name: "Stora Konferensrummet", email: "storakonferensrummet@hissen.se" },
    { name: "Västberga.mote1", email: "vastberga.mote1@hissen.se" },
    { name: "Västberga.mote2", email: "vastberga.mote2@hissen.se" },
    // Lägg till fler rum här
];

async function fetchRoomStatus(email) {
    try {
        const res = await fetch(`${API_URL}?room=${encodeURIComponent(email)}`);
        return await res.json();
    } catch (err) {
        console.error("Fel vid hämtning:", err);
        return { meetings: [], error: "Kunde inte kontakta API" };
    }
}

async function updateRooms() {
    const container = document.getElementById("roomsContainer");
    container.innerHTML = "";

    for (const room of rooms) {
        const data = await fetchRoomStatus(room.email);
        const now = new Date();
        let statusText = "Okänt";
        let statusClass = "";

        if (data.error) {
            statusText = "Fel";
            statusClass = "error";
        } else {
            const ongoing = data.meetings.find(m => new Date(m.start.dateTime) <= now && now <= new Date(m.end.dateTime));
            statusText = ongoing ? "Upptaget" : "Ledigt";
            statusClass = ongoing ? "upptaget" : "ledigt";
        }

        const card = document.createElement("div");
        card.className = `room-card ${statusClass}`;
        card.textContent = `${room.name} - ${statusText}`;
        card.onclick = () => window.location.href = `/Motesrum/?room=${encodeURIComponent(room.email)}`;
        container.appendChild(card);
    }
}

// Uppdatera varje minut
updateRooms();
setInterval(updateRooms, 60000);

// Full reload varje halvtimme
setInterval(() => { location.reload(); }, 1000*60*30);
</script>

</body>
</html>
